{{define "game-board"}}
<main id="game-board" class="mx-auto maxw-350">
    {{if .error_code}}
    <div
        class="visually-hidden"
        aria-live="assertive"
        aria-atomic="true"
        data-error-code="{{.error_code}}"
    ></div>
    {{end}} {{range $row, $guesses := .game.Guesses}}
    <div class="guess-row d-flex justify-content-center mb-1">
        {{if and (eq $row $.game.CurrentRow) (not $.game.GameOver)}}
        <template x-for="i in Array.from({length: 5}, (_,i)=>i)">
            <div
                class="tile border border-2 rounded d-flex align-items-center justify-content-center fw-bold text-uppercase mx-1 tile-active"
                :class="currentGuess && currentGuess[i] ? 'filled' : ''"
            >
                <span
                    x-text="currentGuess && currentGuess[i] ? currentGuess[i] : ''"
                ></span>
            </div>
        </template>
        {{else}} {{range $col, $guess := $guesses}}
        <div
            class="tile border border-2 rounded d-flex align-items-center justify-content-center fw-bold text-uppercase mx-1{{if $guess.Letter}} filled tile-{{$guess.Status}}{{end}}"
        >
            {{$guess.Letter}}
        </div>
        {{end}} {{end}}
    </div>
    {{end}} {{if .newGame}}
    <span id="new-game-flag" class="d-none"></span>
    {{end}} {{if .retryGame}}
    <span id="retry-game-flag" class="d-none"></span>
    {{end}} {{if .game.GameOver}}
    <div class="mt-3 p-3 bg-body-secondary rounded shadow-sm maxw-350">
        {{if .game.Won}}
        <h3 class="text-success text-center h5 mb-2">ðŸŽ‰ Congratulations! ðŸŽ‰</h3>
        <p class="text-center mb-3 small">
            You guessed the word in {{len .game.GuessHistory}} {{if eq (len
            .game.GuessHistory) 1}}try{{else}}tries{{end}}!
        </p>
        <div class="d-flex flex-column align-items-center gap-2 mb-2">
            <button
                class="btn btn-primary vl-btn-shared btn-sm btn-max-130"
                onclick="shareResults()"
            >
                <i class="bi bi-share"></i> Share Results
            </button>
        </div>
        {{else}}
        <h3 class="text-danger text-center h5 mb-2">Game Over!</h3>
        <p class="text-center mb-2 small">
            The word was: <strong>{{.game.TargetWord}}</strong>
        </p>
        <p class="text-center text-muted small mb-3">
            Don't give up! Try again or start a new game.
        </p>
        <div class="d-flex justify-content-center gap-2 mb-2">
            <form method="POST" action="/retry-word" class="d-inline">
                {{if $.csrf_token}}
                <input
                    type="hidden"
                    name="csrf_token"
                    value="{{$.csrf_token}}"
                />
                {{end}}
                <button
                    type="submit"
                    class="btn btn-outline-primary vl-btn-shared btn-sm"
                >
                    <i class="bi bi-arrow-repeat"></i> Retry Word
                </button>
            </form>
            <form
                hx-post="/new-game"
                hx-target="#game-content-container"
                hx-swap="innerHTML"
                hx-indicator=".loading-indicator"
                class="d-inline"
                @submit="prepareNewGameData($event)"
            >
                {{if $.csrf_token}}
                <input
                    type="hidden"
                    name="csrf_token"
                    value="{{$.csrf_token}}"
                />
                {{end}}
                <input
                    type="hidden"
                    name="completedWords"
                    x-ref="completedWordsInput"
                    value=""
                />
                <button
                    type="submit"
                    class="btn btn-primary vl-btn-shared btn-sm"
                >
                    <i class="bi bi-arrow-clockwise"></i> New Game
                </button>
            </form>
        </div>
        <div class="d-flex flex-column align-items-center gap-2 mb-2">
            <button
                class="btn btn-primary vl-btn-shared btn-sm btn-max-130"
                onclick="shareResults()"
            >
                <i class="bi bi-share"></i> Share Results
            </button>
            <form
                hx-post="/new-game"
                hx-target="#game-content-container"
                hx-swap="innerHTML"
                hx-indicator=".loading-indicator"
                class="d-inline"
                @submit="prepareNewGameData($event)"
            >
                {{if $.csrf_token}}
                <input
                    type="hidden"
                    name="csrf_token"
                    value="{{$.csrf_token}}"
                />
                {{end}}
                <input
                    type="hidden"
                    name="completedWords"
                    x-ref="completedWordsInput"
                    value=""
                />
                <button
                    type="submit"
                    class="btn btn-primary vl-btn-shared btn-sm btn-max-130"
                >
                    <i class="bi bi-arrow-clockwise"></i> New Game
                </button>
            </form>
        </div>
        {{end}}
    </div>
    {{end}}
</main>
{{end}}
